---
title: "Introduction to ANOVA"
date: "November 29, 2021"
author: "Dr. Allison Theobold"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "slide-style.css"]
    nature:
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
---


```{r, echo = FALSE, message = FALSE, warning = FALSE}
# R options
options(
  htmltools.dir.version = FALSE,
  tibble.width = 65,
  width = 65
  )

# figure height, width, dpi
knitr::opts_chunk$set(fig.width = 8, 
                      fig.asp = 0.618,
                      out.width = "60%",
                      dpi = 300, 
                      warning = FALSE, 
                      message = FALSE, 
                      fig.align = "center")

# fontawesome
htmltools::tagList(rmarkdown::html_dependency_font_awesome())

# magick
dev.off <- function(){
  invisible(grDevices::dev.off())
}

# xaringanExtra
library(xaringanExtra)
xaringanExtra::use_panelset()

library(emo)
library(tidyverse)
library(openintro)
library(ggridges)
library(flair)
library(moderndive)

options(show.signif.stars = FALSE)
```

```{r set-theme, include = FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color      = "#b76352", # mango
  secondary_color    = "#34605f", # bayberry
  header_font_google = google_font("Raleway"),
  text_font_google   = google_font("Raleway", "300", "300i"),
  code_font_google   = google_font("Source Code Pro"),
  header_color = "#793540", #rhubarb
  white_color = "#F5F5F5", # lightest color
  black_color = "#36454F", # darkest color
  text_font_size = "30px", 
  link_color = "#696969" #grey
)
```

class: center, middle

.huge[Goal of an ANOVA]

.large[Analysis of variance (ANOVA) compares the means of three of more groups
to detect if the means of the groups are different.]

---

class: middle

.huge[**How???**]

--

ANOVA assess the differences in the group means relative to the 
variability in the observations within each group. 

--

Ideally, we'd like to see:  

- large differences in the means of the groups 
- small amounts of variability within each group

---

class: middle, center, inverse

```{r, echo = FALSE, out.width = "90%"}
hfi %>% 
  ggplot(mapping = aes(y = region, x = hf_score)) + 
  geom_boxplot() + 
  labs(x = "Human Freedom Score", 
       y = "") +
  theme(axis.title = element_text(size = 18), 
        axis.text.y = element_text(size = 16), 
        axis.text.x = element_text(size = 14))
```

<!-- What can you say about the differences between the groups?   -->

<!-- What can you say about the variability within the groups?  -->

---

class: center, middle

.larger[**Step 1: Test if _at least one_ mean is different**]

--

.large[Summarize differences with an F-statistic] 

--

.large[Use parametric (F-distribution) or simulation-based
(permutation distribution) methods to obtain a p-value]

---

class: center, middle

.larger[**Step 2: If the null hypothesis was rejected...**]

.large[determine *which* group means are different.]

--

.large[.mango[Why not only pick out the groups that look different?]]

---

class: middle 

.larger[**Multiple Comparisons**]  

The idea of multiple comparisons is that you perform a difference in means 
comparison (i.e. $\mu_1 = \mu_2$) for every possible combination of group means. 

--

.pull-left[
- As the number of groups increases, the number of comparisons gets big fast!

- For these data that is ${10 \choose 2} = 45$ possible differences in means! 
]

--

.pull-right[
When conducting __lots__ of hypothesis tests, we need to start worrying about 
our Type I error rates. 

- We expect to make a Type I error about 5% of the time with an $\alpha$ of 0.05. 
]

---

.larger[**Bonferroi Adjustment**]

We can fix the error rate problem by specifying a "family" $\alpha$ value, for 
all of the comparisons.  

.pull-left[
- The family $\alpha$ is then spread to each test evenly. 

- This is called the Bonferroni correction. 
]

.pull-right[
```{r, out.width = "40%", echo = FALSE, fig.align='center', fig.cap="Carlo Emilio Bonferroni (1882-1960)"}
knitr::include_graphics("images/Bonferroni.jpg")
```
]

---

class: center 

.larger[**Family Error Rate**]

The new $\alpha$ is $\alpha^\star = \frac{\alpha}{k}$, where $k$ is the
number of comparisons / hypotheses. 

</br> 

For testing 45 groups at the 0.05 significance level,  
$$\alpha^\star = \frac{0.05}{45} = 0.0011$$

---

class: center, middle, inverse

.huge[For your project...]

---

.larger[Before...]

```{r, echo = FALSE}
hfi %>% 
  filter(year == 2016) %>% 
  ggplot(mapping = aes(x = pf_score, y = hf_score)) + 
  geom_point() + 
  labs(x = "Personal Freedom Score", 
       y = "Human Freedom Score") +
  theme(axis.title = element_text(size = 18), 
        axis.text.y = element_text(size = 16), 
        axis.text.x = element_text(size = 14))
```


---

.larger[Now...]

```{r, echo = FALSE, out.width = "70%"}
hfi %>% 
  filter(year == 2016) %>% 
  mutate(pf_score_f = case_when(pf_score < 5 ~ "low", 
                                pf_score >= 5 & pf_score < 8 ~ "medium", 
                                pf_score >= 8 ~ "high"), 
         pf_score_f = factor(pf_score_f, levels = c("low", "medium", "high")
                             )
         ) %>% 

  ggplot(mapping = aes(x = pf_score_f, y = hf_score)) + 
  geom_boxplot() + 
  labs(x = "Personal Freedom Score", 
       y = "Human Freedom Score") +
  theme(axis.title = element_text(size = 18), 
        axis.text.y = element_text(size = 16), 
        axis.text.x = element_text(size = 14), 
        legend.text = element_text(size = 14), 
        legend.title = element_text(size = 16))
```

---

.larger[Next...]

```{r, echo = FALSE, out.width = "70%"}
hfi %>% 
  mutate(pf_score_f = case_when(pf_score < 5 ~ "low", 
                                pf_score >= 5 & pf_score < 8 ~ "medium", 
                                pf_score >= 8 ~ "high"), 
         pf_score_f = factor(pf_score_f, levels = c("low", "medium", "high")
                             ), 
         year_f = as.factor(year)
         ) %>% 
  filter(!is.na(pf_score_f)) %>% 

  ggplot(mapping = aes(x = pf_score_f, y = hf_score, fill = year_f)) + 
  geom_boxplot() + 
  labs(x = "Personal Freedom Score", 
       y = "Human Freedom Score", 
       fill = "Year") +
  theme(axis.title = element_text(size = 18), 
        axis.text.y = element_text(size = 16), 
        axis.text.x = element_text(size = 14))
```

