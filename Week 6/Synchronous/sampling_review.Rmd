---
title: "Sampling Variability -- The Heart of Inference"
date: "October 28, 2021"
author: "Dr. Allison Theobold"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "slide-style.css"]
    nature:
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
---


```{r, echo = FALSE, message = FALSE, warning = FALSE}
# R options
options(
  htmltools.dir.version = FALSE,
  tibble.width = 65,
  width = 65
  )

# figure height, width, dpi
knitr::opts_chunk$set(fig.width = 8, 
                      fig.asp = 0.618,
                      out.width = "60%",
                      dpi = 300, 
                      warning = FALSE, 
                      message = FALSE, 
                      fig.align = "center")

# fontawesome
htmltools::tagList(rmarkdown::html_dependency_font_awesome())

# magick
dev.off <- function(){
  invisible(grDevices::dev.off())
}

# xaringanExtra
library(xaringanExtra)
xaringanExtra::use_panelset()

library(emo)
library(tidyverse)
library(openintro)
library(ggridges)
library(flair)
library(broom)
library(gridExtra)
library(kableExtra)
library(png)
library(moderndive)

options(show.signif.stars = FALSE)
```

```{r set-theme, include = FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color      = "#b76352", # mango
  secondary_color    = "#34605f", # bayberry
  header_font_google = google_font("Raleway"),
  text_font_google   = google_font("Raleway", "300", "300i"),
  code_font_google   = google_font("Source Code Pro"),
  header_color = "#793540", #rhubarb
  white_color = "#F5F5F5", # lightest color
  black_color = "#36454F", # darkest color
  text_font_size = "30px", 
  link_color = "#696969" #grey
)
```

## Data Context

```{r data}

coaches <- read_csv(here::here("Week 6", "Synchronous", 
                               "data", "cu_csu_coaches.csv"))
csu <- coaches %>% 
  filter(Agency == "California State University")

uc <- coaches %>% 
  filter(Agency == "University of California")

total_sample <- 150
csu_n <- ( nrow(csu) / (nrow(csu) + nrow(uc)) ) * total_sample
uc_n <- ( nrow(uc) / (nrow(uc) + nrow(csu)) ) * total_sample


csu_sample <- csu %>% 
  slice_sample(n = 
                 floor(csu_n)
               )

uc_sample <- uc %>% 
  slice_sample(n = 
                 floor(uc_n)
               )
```


Election news is everywhere we look, but gives us an amazing context to explore 
sampling variability. 

```{r,fig.align='center', out.width= "80%", echo = FALSE}
knitr::include_graphics("wide_poll.png")
```

## Sampling 

We may be interested in the proportion of US citizens voting for a particular 
candidate, however it is unreasonable to sample every citizen. 

- We take a sample of individuals, with the interest in inferring what we found 
in our sample to a larger population of individuals. 

- We typically only get one sample, but repeated sampling gives us a better idea 
of the variation in responses. 


```{r, echo = FALSE}

polling <- tibble(name = randomNames(30, which.names = "first"), 
                        biden = rbinom(n = 30, size = 1, prob = 0.522)) %>% 
  mutate(biden = if_else(biden == 0, "no", "yes"))
```

## Sampling Variation

<div class="columns-2">

```{r, echo = FALSE}
polling
```

```{r}
polling %>% 
  count(biden)
```


## Virtual Sampling 

```{r, echo = FALSE, cache=TRUE}
polling_large <- tibble(name = randomNames(2500, which.names = "first"), 
                        candidate = rbinom(n = 2500, size = 1, prob = 0.522)) %>% 
  mutate(candidate = if_else(candidate == 0, "Trump", "Biden")
         )
```

Technically there are approximately 250,056,000 people in the US who are of 
voting age. If we had a record of every person and their vote, we could take 
repeated samples from this database of votes. 

```{r}
virtual_poll <- polling_large %>% 
  rep_sample_n(size = 50, reps = 1000)
```

```{r, echo = FALSE}
virtual_poll
```


## Distribution of Proportions for Multiple Samples

<div class="columns-2">

```{r, echo = FALSE}
virtual_poll %>% 
  group_by(replicate) %>% 
  summarize(n_biden = sum(candidate == "Biden")) %>% 
  mutate(prop_biden = n_biden / 50) 
```

```{r, echo = FALSE, fig.width=3}
virtual_poll %>% 
  group_by(replicate) %>% 
  summarize(n_biden = sum(candidate == "Biden")) %>% 
  mutate(prop_biden = n_biden / 50) %>% 
  ggplot(aes(x = prop_biden)) + 
  geom_histogram(bins = 12)
```

## Sampling Distributions 

- Visualize the effect of sampling variation on the distribution of any point
estimate -- in this case, the sample proportion  

<div class="columns-2">

```{r, echo = FALSE, fig.width = 4, fig.height=4}
virtual_poll %>% 
  group_by(replicate) %>% 
  summarize(n_biden = sum(candidate == "Biden")) %>% 
  mutate(prop_biden = n_biden / 50) %>% 
  ggplot(aes(x = prop_biden)) + 
  geom_dotplot(dotsize = 0.25, color = "blue") + 
  labs(title = "1000 Samples of Size 50")
```

</br> 

```{r, echo = FALSE, fig.width = 8, fig.height=4}

polling %>% 
  count(biden)

```

## Distribution of Proportions for Different Sample Sizes

```{r, echo = FALSE, warning=FALSE, message=FALSE}
poll_25 <- polling_large %>% 
  rep_sample_n(size = 25, reps = 1000) %>% 
  group_by(replicate) %>% 
  summarize(n_biden = sum(candidate == "Biden")) %>% 
  mutate(prop_biden = n_biden / 25) 

poll_50 <- polling_large %>% 
  rep_sample_n(size = 50, reps = 1000) %>% 
  group_by(replicate) %>% 
  summarize(n_biden = sum(candidate == "Biden")) %>% 
  mutate(prop_biden = n_biden / 50) 

poll_100 <- polling_large %>% 
  rep_sample_n(size = 100, reps = 1000) %>% 
  group_by(replicate) %>% 
  summarize(n_biden = sum(candidate == "Biden")) %>% 
  mutate(prop_biden = n_biden / 100) 
```

```{r, echo = FALSE, fig.width = 8}
plot_25 <- poll_25  %>% 
  ggplot(aes(x = prop_biden)) + 
  geom_histogram(bins = 15) + 
  xlim(c(0.1, 0.9)) +
  labs(title = "Sample Size 25")

plot_50 <- poll_50  %>% 
  ggplot(aes(x = prop_biden)) + 
  geom_histogram(bins = 15) + 
  xlim(c(0.1, 0.9)) +
  labs(title = "Sample Size 50")

plot_100 <- poll_100 %>% 
  ggplot(aes(x = prop_biden)) + 
  geom_histogram(bins = 15) + 
  xlim(c(0.1, 0.9)) +
  labs(title = "Sample Size 100")


grid.arrange(plot_25, plot_50, plot_100, nrow = 1)

```


## Standard Deviations for Different Sample Sizes 

```{r, echo = FALSE, eval = FALSE}

sds <- poll_25 %>% 
  summarize(mean = mean(prop_biden), 
            sd = sd(prop_biden))

sds <-  rbind(sds, 
        poll_50 %>% 
  summarize(mean = mean(prop_biden), 
            sd = sd(prop_biden)))

sds <-  rbind(sds, 
        poll_100 %>% 
  summarize(mean = mean(prop_biden), 
            sd = sd(prop_biden)))
```

| Sample Size | Estimate | SD     |
| ----------- |:--------:| ------:|
| n = 25      | 0.534    | 0.0986 |
| n = 50      | 0.529    | 0.0720 |
| n = 100     | 0.527    | 0.0489 |




## Precision & Accuracy 

```{r,fig.align='center', out.width= "60%", echo = FALSE}
knitr::include_graphics("precision_accuracy.png")
```
