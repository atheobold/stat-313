---
title: "Simple Linear Regression -- R Skills"
date: "October 13, 2021"
output: html_document
---

## Old Packages 

```{r, message = FALSE}
library(tidyverse)
```


## New Packages

```{r}
library(moderndive)
library(skimr)
```

## Data for Today

Today we'll be working with housing data for King County, the county that
includes Seattle. The dataset includes data on 21,613 homes sold between May
2014 and May 2015. The data are stored in the `house_prices` dataset, which 
lives in the **moderndive** package. 

## Visualize a Simple Linear Regression 

Let's start with tools to visualize and summarize linear regression. 

### Tools 
1. Visualize the relationship between x & y -- `geom_point()` 
2. Visualize the linear regression line -- `geom_smooth()`

We will be investigating the relationship between the `price` of a home and 
the square feet of living space (`sqft_living`). 

### Step 1 

First, let's make a scatterplot of the relationship between the `price`
of a home (response) and the living space of the home (explanatory). 

```{r plot, message = FALSE}
# Code to make scatterplot goes here!

house_prices %>% 
  ggplot(mapping = aes(x = sqft_living, y = price)) + 
  geom_point(shape = ".") + 
  geom_smooth(method = "lm")
```

Unfortunately, there are *a lot* of observations, so it is difficult to see 
the individual points. This is called "overplotting," where it is difficult 
to discern the individual points. There are two ways to remedy this:

1. make the points smaller -- using `size = "."`
2. make the points more transparent -- using `alpha = 0.1`

__Try one of these two options in your scatterplot above!__ 

### Step 2

Next, lets add a linear regression line to the scatterplot you made above. 
To add a regression line, you add (`+`) a `geom_smooth()` layer to your plot. 

Notice when you add a "plain" `geom_smooth()` to the plot, it uses a wiggly 
line. You need to tell `geom_smooth()` what type of smoother line you want for 
it to use! Include a `method = "lm"` argument __inside__ of your
`geom_smooth()`. 

<!-- You don't need to write code here! Modify the code you wrote for Step 1! -->

# Fit a Simple Linear Regression Model

Next, we are going to summarize the relationship between `price` and 
`sqft_living` with a linear regression equation. 

### Tools
1. Calculate the correlation between x & y -- `get_correlation()`
2. Model the relationship between x & y -- `lm()`
3. Explore fitted values, residuals, etc. -- `get_regression_table()`

### Step 1

First, we will calculate the correlation between these variables, using the 
`get_correlation()` function. 

```{r correlation}
# Code to find correlation goes here!


```

### Step 2

Next, we will "fit" a linear regression with the `lm()` function. Remember, 
the "formula" for `lm()` is `response_variable ~ explanatory_variable`. Also 
recall that you need to tell `lm()` where the data live using `data =`!

You will need to save the linear regression into an object, so you can use it 
later. Make sure to give it an easy to remember name!

```{r}
# Code to fit a linear regression between price and sqft_living goes here!


```

### Step 3

Finally, to get the regression equation, we need grab the coefficients out of 
the linear model object. The `get_regression_table()` function is a handy tool 
to do just that! 

```{r coefficients}
# Code to get the regression table goes here! 


```


# A Little Extra...

As you may have noticed, the trend between `price` and `sqft_living` isn't 
"perfectly" linear. We can make the relationship look a bit more linear with the
help of some transformations. As we can see, both `price` and `sqft_living` are
right skewed (there are large / extreme values in the right tail). 

We can transform our x- and y-variable by using the `scale_x_log10()` option
or the `scale_y_log10()` option. These options are added (`+`) to the original 
plot, like so:

```{r log-example}
house_prices %>% 
  ggplot(mapping = aes(x = sqft_living, y = price)) + 
  geom_point(alpha = 0.2) +
  geom_smooth(method = "lm") +
  scale_x_log10()
```

__Use the `scale` functions to take a log transform *both* the x- and y-variables.__


# A Little More...

Finally, our plots always look a bit nicer with better axis labels. There is 
a handy function that allows for you to change **all** of your axis labels in 
one place! 

The `labs()` function changes all of the labels on your plot. All you need to 
do is specify what label you want to change (e.g., `x`, `y`, `color`, `fill`,
`title`, `subtitle`) and what label you want to be there instead. Note, the 
label needs to be in quotation marks! 

Here is an example of what this would look like:

```{r labs-example}
house_prices %>% 
  ggplot(mapping = aes(x = sqft_living, y = price)) + 
  geom_point(alpha = 0.2) +
  geom_smooth(method = "lm") + 
  labs(x = "Total Square Footage of Home (ft)", 
       y = "Selling Price of Home ($)")
```

__Use the `labs()` function to create nice axis labels for your favorite plot you've made!__
