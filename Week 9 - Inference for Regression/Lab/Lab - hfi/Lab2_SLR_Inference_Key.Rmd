---
title: Inference for to Linear Regression - Key
author: Dr. Theobold
output: html_document
---

```{r global_options, include=FALSE}
## These are global specifications for how the RMarkdown file should knit. 
## Do not change these or delete these!
knitr::opts_chunk$set(eval = TRUE,
                      warning = FALSE,
                      fig.align = "center", 
                      message = FALSE, 
                      fig.width = 4, 
                      fig.height = 4)
```

The Human Freedom Index is a report that attempts to summarize the idea of "freedom" through a bunch of different variables for many countries around the globe.
It serves as a rough objective measure for the relationships between the different types of freedom - whether it's political, religious, economical or personal freedom - and other social and economic circumstances.
The Human Freedom Index is an annually co-published report by the Cato Institute, the Fraser Institute, and the Liberales Institut at the Friedrich Naumann Foundation for Freedom.

In this lab, you'll be analyzing data from Human Freedom Index reports from 2008-2016.
Your aim will be to summarize a few of the relationships within the data both graphically and numerically in order to discuss how different variables can help tell a story about freedom.

# Getting Started

## Load Packages

In this lab, you will explore and visualize the data using the **tidyverse** suite of packages. 

You will also use the **moderndive** package to get nice looking regression tables. 

The data can be found in the **openintro** package.

Let's load the packages!

```{r load-packages, message=FALSE}
library(tidyverse)
library(moderndive)
library(openintro)
library(infer)
```

# The data

The data we're working with is in the openintro package and it's called `hfi`, short for Human Freedom Index.

__1.  The dataset has **a lot** of variables, but we are only interested in four: hf_score, pf_score, year, and region. *Select* these variables from the hfi dataframe, and assign the result to a dataframe named hfi_small.__ 

```{r}
## Fill in the code necessary for question 2 

hfi_small <- hfi %>% 
  select(pf_score, hf_score, year, region)

```


We can use the `drop_na()` function to get an idea of how many observations have missing data. The function looks row by row through the data to decide what rows should be kept. If there is an `NA` value in a row, that row is discarded. The result is a dataframe where there are no missing values for any of the variables. 

__2. Use the drop_na() function to create another new dataframe named hfi_small_clean that **does not** contain any missing values.__ 

```{r}
hfi_small_clean <- drop_na(hfi_small)

```

# Visualizing the Relationship Between Economic Freedom and Personal Freedom 

__3. (a) Plot the relationship between `ef_score` (x) and `pf_score` (y), including a linear regression line.__
__3. (b) Does the relationship look linear? How strong is the relationship?__
Hint: This is a great instance to use `geom_jitter()`!  
<!-- Your response goes here! Do not remove this line! -->

*The relationship appears linear, and is fairly strong!*


```{r}
## Code for question 4
hfi_small_clean %>%
  ggplot(mapping = aes(y = hf_score, x = pf_score)) + 
  geom_jitter() + 
  geom_smooth(method = "lm") +
  facet_wrap(~year)

```

__4. Now, add a facet for each year in the dataset. Does it appear that this relationship changes over time?__

<!-- Change your code from Question 4. Only your response goes here! -->

*It looks like the overall trend is similar across the years, but some years have more variability in these scores than others. For example, 2008 is fairly tightly clustered around the regression line, but 2016 has a bit more variability in lower personal freedom scores.*


# Modeling the Relationship Between Human Freedom and Personal Freedom 

We will investigate the relationship between Personal Freedom and Economic 
Freedom, determining if there is evidence that this relationship changes over
time. 

Our statistical method will be driven by the conditions for our linear
regression. 

## Checking Conditions 

You've already discussed the *linear relationship* condition, so let's move on 
to the independence condition. 

__5. Given that we're accounting for year, do you believe it is reasonable to assume these observations are independent? Why or why not?__
<!-- Your response goes below this line! -->

*There could still be some geographical similarities that have not been accounted for. For example, the European Union has regulatory measures that could make the observations of countries share information.* 

To perform a residual analysis, we first need to fit the multiple linear 
regression. We are interested in determining if the relationship between 
pf_score and ef_score is different for different years. This should sound similar
to the interaction model we used before! 

__6. Fill in the code below to fit a multiple linear regression, which allows for an interaction between year and ef_score.__

```{r}
pf_lm <- lm(hf_score ~ pf_score * year , data = hfi)
```

Next, you'll use the code below to diagnose the *normality* and *equal variance* conditions. 

```{r}
get_regression_points(pf_lm) %>% 
  ggplot(mapping = aes(x = residual)) + 
  geom_histogram(binwidth = 0.15)
```

__7. Based on the plot above, do you believe the normality condition is violated? Why or why not?__

*I would not say that this condition is violated. It appears that the distribution of the residuals is centered at 0 and bell-shaped and symmetric.*

```{r}
get_regression_points(pf_lm) %>% 
  ggplot(mapping = aes(y = residual, x = hf_score_hat)) + 
  geom_jitter() + 
  geom_hline(yintercept = 0, color = "red", size = 1)

```

__8. Based on the plot above, do you believe the equal variance condition is violated? Why or why not?__

*While the plot does not look great, I don't see any major issues. The residuals are fairly small, ranging from -1 to 1, across the majority of the regression line (in red). There may be slightly less variability in the larger values of human freedom scores (hf_score_hat), but not enough to warrant concerns.*


## Hypothesis Test for the Slope 

First, we will carry out a hypothesis test to investigate if the relationship
between hf_score and pf_score differs by year. This entails that we are first 
testing to see if we need the interaction term in our multiple linear 
regression. These hypotheses are a bit different than before, so let's walk
through them. 

To test if an interaction term is needed, we are testing if the slope on
pf_score should change based on the year. For a quantitative variable, this is
either a "yes" or "no" answer. The hypotheses look like the following:

H_0: the true relationship between x and y *does not* differ by z

H_A: the true relationship between x and y *does* differ by z


__9. Using the template above, write out the null and alternative hypotheses we are testing, in the context of these data.__   
<!-- Your response goes here! Do not remove this line! -->

*H_0: the relationship between human freedom score and personal freedom does not differ by year*

*H_A: the relationship between human freedom score and personal freedom does differ by year*


__10. Report the p-value for this hypothesis test. What would you conclude for this test?__   
Hint 1: Deciding to reject or not **is not** a conclusion, you need to specify which hypothesis seems more plausible **and** what that means in the context of these data!   
Hint 2: Stating you reject the null hypothesis requires that you specify an $\alpha$ that was used.
Hint 3: There should be no use of the term "significant" in your conclusion. 
<!-- Your response goes here! Do not remove this line! -->

*Based on the regression table below, the p-value for this test is approximately 0. Thus, we would conclude that the null hypothesis seems unlikely to be true. At an alpha of 0.01, I would reject the null hypothesis and conclude that there is evidence the relationship between human freedom score and personal freedom does differ by year.* 


```{r}
## Code for finding the p-value goes below this line! 

get_regression_table(pf_lm)

```


__11. How would you interpret this interaction term?__
__Give this your best shot! I will be grading based on the ideas you present.__
__See if you can make connections between this coefficient and what you saw with a categorical explanatory variable.__

*The interaction is interpreted as adjusting the slope based on the year of the observation. The data has years from 2008 to 2016, and year is considered as a continuous numerical variable. So, we would plug in the year and obtain the amount we need to adjust the slope by.* 

*We notice that the interaction is negative, meaning we are always adjusting our slope down from the "baseline". For 2008, we would decrease the slope by $2008 \times -0.006 = 12.048$, resulting in a slope on pf_score of $13.2 - 12.048 = 1.152$. For 2016, we would decrease the slope by $2016 \times -0.006 = 12.096$, resulting in a slope on pf_score of $13.2 - 12.096 = 1.104.$*


