---
title: "Small Group Collaboration - Session 6"
date: "October 29, 2020"
output: ioslides_presentation
---

<style type="text/css">
slides > slide:not(.nobackground):after {
  content: '';
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, 
                      echo = FALSE, 
                      fig.width = 4, 
                      fig.height = 4, 
                      message = FALSE)
library(tidyverse)
library(openintro)
library(gridExtra)
library(moderndive)
library(infer)
library(okcupiddata)

profiles <- 
  profiles %>% 
  mutate(orientation = if_else(orientation == "straight", orientation, "queer"))

obs_diff <- profiles %>% 
  filter(!is.na(height), 
         height > 36) %>% 
  specify(height ~ orientation) %>% 
  calculate(stat = "diff in means", order = c("straight", "queer"))
```

## Data Description

The data consist of the profiles of 59,946 OkCupid users who were living within
25 miles of San Francisco, had active profiles on June 26, 2012, were online in
the previous year, and had at least one picture in their profile.

## Data Preview 

```{r}
glimpse(profiles)
```

## Question of Interest

We're interested in whether the mean `height` reported for individuals identifying 
as "male" differs by `orientation`. 

i.e. Are the mean heights for users who identify as "male" and "straight" 
different from the mean heights for users who identify as "male" and "queer"? 

__What hypotheses would you use for your null and alternative hypothesis?__ 

## Data Wrangling

- How would you create a dataset of only individuals who identified as "male"? 

- Orientation was recorded as "gay", "bisexual", or "straight". If we wanted to 
combine "gay" and "bisexual" into one level called "queer", what tools would we
use? 

## Data Visualizaton 

<center>

```{r, echo = FALSE, warning = FALSE, fig.height=4, fig.width=5}
profiles %>% 
  ggplot(aes(y = orientation, x = height, fill = orientation)) + 
  geom_violin() + 
  theme(legend.position = "none")
```

What do you notice about the distribution of heights between the two groups?

What units do you think `height` was reported in?

## Data Investigation 

```{r, echo = FALSE}
profiles %>% 
  filter(!is.na(height)) %>% 
  group_by(orientation) %>% 
  summarize(min_height = min(height), 
            max_height = max(height), 
            median_height = median(height), 
            mean_height = mean(height))
```

</br> 

How would you filter out observations that had "ridiculous" values for `height`? 

## Hypothesis Test 

Below is a null distribution of permuted differences in means. What steps were 
used to generate this distribution? 

</br> 

```{r, echo = FALSE, cache=TRUE, fig.width=8}
null <- profiles %>% 
  filter(!is.na(height), 
         height > 36) %>% 
  specify(height ~ orientation) %>% 
  hypothesise(null = "independence") %>% 
  generate(reps = 1000, type = "permute") %>% 
  calculate(stat = "diff in means", order = c("straight", "queer"))

null %>% 
  visualize() + 
  ggtitle("Difference in Mean Reproted Height (Straight - Queer)")
```

## Calculate the p-value 

</br> 

- Given the null distribution, how would you calculate the p-value for the 
hypothesis test? 

</br>

- If there were no permuted difference in means as large as the one observed, 
what would you conclude? 


## Different Questions 

</br> 

A hypothesis test lead us to conclude that the self-reported heights between 
users who identified as "male" and "straight" were different from users who 
identified as "male" and "queer". 

- What type of question would a confidence interval address? 


## Bootstrap Distribution 

</br> 

To create a bootstrap distribution we no longer assume the null hypothesis is 
true. 

- How does that change our process of generating new differences in means? 


## Confidence Interval

Below is a bootstrap distribution for 1000 bootstrap resamples. 

- Where is the distribution centered? Why is that the case? 

- How would you use this distribution to create a 99% confidence interval for 
the difference in mean reported heights? 

```{r, echo = FALSE, fig.width=5, cache=TRUE, fig.height=3, fig.align='center'}
boot <- profiles %>% 
    filter(!is.na(height), 
         height > 36) %>% 
  specify(height ~ orientation) %>% 
  generate(reps = 1000, type = "bootstrap") %>% 
  calculate(stat = "diff in means", order = c("straight", "queer"))

boot %>% 
  visualise()
```

## Interpretting a Confidence Interval 

The 99% confidence interval was calculated to be (0.252, 0.471). 

- How would you interpret this interval? 

- Does it seem like the difference in mean height between the two groups is 
really that different? 

- Why then do you think the hypothesis test had a p-value of approximately 0? 

