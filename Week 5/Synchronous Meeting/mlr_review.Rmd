---
title: "Multiple Regression Review"
date: "October 14, 2020"
output: ioslides_presentation
fig_height: 4
fig_width: 4
---

<style type="text/css">
slides > slide:not(.nobackground):after {
  content: '';
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, 
                       message = FALSE, 
                      fig.width = 5, 
                      fig.height = 4, 
                      results = "hold")

options(show.signif.stars = FALSE)
library(tidyverse)
library(moderndive)
library(openintro)
library(flair)
library(broom)
library(gridExtra)
library(kableExtra)
```

## Data Context

- Most college courses conclude with anonymous student evaluations.
- Evaluations as an indicator of course quality and teaching effectiveness is
often criticized.
- Evaluation scores may reflect the influence of non-teaching related
characteristics, such as the physical appearance.

<!-- The article titled, “Beauty in the classroom: instructors’ pulchritude and -->
<!-- putative pedagogical productivity” by Hamermesh and Parker found that -->
<!-- instructors who are viewed to be better looking receive higher instructional -->
<!-- ratings. -->

These data contain observations on 463 courses at the University of Texas 
Austin, with 23 variables recorded in the data:

- information about the course
- information about the professor
- information about number of students 
- information about the "attractiveness" rating of the professor

## Simple Linear Regression Review

We can model the relationship between a professor's evaluation score (`score`)
and their average attractiveness score (`bty_avg`) with a simple linear 
regression!

- Scores for average beauty can range from 0 to 10
- Evaluation scores can range from 1 to 5

</br>
</br>
<center>
__What are the model conditions we need to check for a simple linear regression?__ 


## Visualizing SLR

```{r slr-viz, echo = FALSE, eval = FALSE}
evals %>% 
  ggplot(aes(x = bty_avg, y = score)) + 
  geom_jitter() + 
  geom_smooth(method = "lm")

```

```{r, echo = FALSE}
decorate("slr-viz") %>% 
  flair("geom_jitter")
```

## Fitting a SLR Model

```{r}
model1 <- lm(score ~ bty_avg, data = evals)

get_regression_table(model1)
```

</br>
<center>

__How would we interpret the intercept and slope from this model?__

## Multiple Linear Regression

In multiple regression we include __multiple__ explanatory variables, which can 
be categorical or quantitative. 

</br>

- Categorical variables lead to different regression lines

- Quantitative variables lead to different planes in dataspace

</br>

__In this course, we will mainly stick to regression models with one
quantitative and one categorical explanatory variables.__ 

## Visualization

```{r mlr-viz, eval = FALSE, echo = FALSE}
evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = gender)) + 
  geom_jitter() + 
  geom_smooth(method = "lm", se = FALSE)
```

```{r, echo = FALSE}
decorate("mlr-viz") %>% 
  flair("color = gender")
```



## Modeling Options

```{r, fig.width = 8, echo = FALSE}
p1 <- evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = gender)) + 
  geom_jitter() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Different Slopes Model") + 
  theme(legend.position = "none")


p2 <- evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = gender)) + 
  geom_jitter() + 
  geom_parallel_slopes(se = FALSE) + 
  labs(title = "Parallel Slopes Model")

grid.arrange(p1, p2, nrow = 1, widths = c(0.45, 0.55))
```

## Fitting a Parallel Slopes Model

```{r}
model2 <- lm(score ~ bty_avg + gender, data = evals)

get_regression_table(model2)
```

## Interpreting a Parallel Slopes Model

```{r, echo = FALSE}
get_regression_table(model2)
```

</br> 

- What does the estimate labeled `gendermale` correspond to?

- Who does the `intercept` correspond to?

- What this relationship between evaluation score and average beauty score for 
the professors in these data?

## Calculating the Different Lines

| Gender    | Intercept | Slope for average beauty  |
| --------- |:---------:| -------------------------:|
| Female    | 3.75      | 0.074 |
| Male      | 3.75 + 0.172 = 3.922     | 0.074 |

```{r, echo = FALSE, eval = FALSE}
options(digits = 4)

table <- get_regression_table(model2)
intercept_female_parallel <- table %>% filter(term == "intercept") %>% pull(estimate)
offset_male <- table %>% filter(term == "gendermale") %>% pull(estimate)
slope <- table %>% filter(term == "bty_avg") %>% pull(estimate)
offset_male_parallel <- table %>% filter(term == "intercept") %>% pull(estimate)
intercept_male_parallel <- intercept_female_parallel + offset_male_parallel

tibble(
  Gender = c("Female instructors", "Male instructors"),
  Intercept = c(intercept_female_parallel, intercept_male_parallel),
  `Slope for age` = c(slope, slope)
) %>%
  kable(format = "html")
```


## Writing a Parallel Slopes Model

$$
\widehat{score} = 3.75 + 0.172 \cdot 1_{\text{is male}} + 0.074 \cdot bty\_avg
$$
where 

$$
1_{\text{is male}} = \begin{cases}
    1, &  \text{ if professor identified as male} \\
    0, & \text{ if professor identified as female}
  \end{cases} 
$$

</br>

- Male Professors:
$$
\widehat{score} = 3.992 + 0.074 \cdot bty\_avg
$$

- Female Professors:
$$
\widehat{score} = 3.75 + 0.074 \cdot bty\_avg
$$

## "Offsets"

The Modern Dive book refers to the adjustments in the intercept and slope 
for different levels of a categorical variable "offsets."

- These describe how the regression line changes when moving from one group to 
another. 

- Intercept offsets change the estimated mean evaluation score when an average 
beauty score is 0. 

- Slope offsets modify the estimated change in the mean evaluation score when 
the average beauty score is increased by 1. 


## Fitting a Different Slopes Model

```{r mlr-slopes, eval = FALSE, echo = FALSE}
model3 <- lm(score ~ bty_avg + gender + bty_avg:gender, data = evals)

get_regression_table(model3)
```

```{r, echo = FALSE}
decorate("mlr-slopes") %>% 
  flair("bty_avg:gender")
```

## Interpreting a Different Slopes Model

```{r, echo = FALSE, eval = FALSE}
get_regression_table(model3)
```

```{r, echo = FALSE}
get_regression_table(model3) %>% 
  select(term, estimate, std_error)
```


</br>

- Who does the `bty_avg` estimate correspond to?

- What does the estimate labeled `bty_avg:gendermale` correspond to?


## Calculating the Different Lines

| Gender    | Intercept | Slope for average beauty  |
| --------- |:---------:| -------------------------:|
| Female    | 3.95      | 0.031 |
| Male      | 3.95 - 0.184 = 3.766     | 0.031 + 0.08 = 0.111 |

## Writing a Different Slopes Model

$$
\widehat{score} = 3.95 - 0.184 \cdot 1_{\text{is male}} + 0.031 \cdot bty\_avg \\ + 0.08 \cdot 1_{\text{is male}} \cdot bty\_avg 
$$
where 

$$
1_{\text{is male}} = \begin{cases}
    1, &  \text{ if professor identified as male} \\
    0, & \text{ if professor identified as female}
  \end{cases} 
$$

</br>

- Male Professors:
$$
\widehat{score} = 3.766 + 0.111 \cdot bty\_avg
$$

- Female Professors:
$$
\widehat{score} = 3.95 + 0.031 \cdot bty\_avg
$$

## Your Turn

```{r}
evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = rank)) + 
  geom_jitter() + 
  geom_smooth(method = "lm", se = FALSE)
```

__Does it seem reasonable to use a different slopes model?__ 

## 

```{r, eval = FALSE}
model4 <- lm(score ~ bty_avg + rank + bty_avg:rank, data = evals)

get_regression_table(model4)
```

```{r, echo = FALSE}
lm(score ~ bty_avg + rank + bty_avg:rank, data = evals) %>% 
  get_regression_table() %>% 
  select(term, estimate, std_error)
```


- What is the estimated regression line for teaching faculty?

- What is the estimated regression line for tenure-track faculty?

- What is the estimated regression line for tenured faculty?



