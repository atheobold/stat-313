---
title: "Multiple Regression Review"
date: "February 3, 2021"
output: ioslides_presentation
fig_height: 4
fig_width: 4
---

<style type="text/css">
slides > slide:not(.nobackground):after {
  content: '';
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, 
                       message = FALSE, 
                      fig.width = 5, 
                      fig.height = 4, 
                      results = "hold", 
                      fig.align = "center")

options(show.signif.stars = FALSE)
library(tidyverse)
library(moderndive)
library(openintro)
library(flair)
library(broom)
library(gridExtra)
library(kableExtra)
```

## Data Context

- Most college courses conclude with anonymous student evaluations.
- Evaluations as an indicator of course quality and teaching effectiveness is
often criticized.
- Evaluation scores may reflect the influence of non-teaching related
characteristics, such as the physical appearance.

<!-- The article titled, “Beauty in the classroom: instructors’ pulchritude and -->
<!-- putative pedagogical productivity” by Hamermesh and Parker found that -->
<!-- instructors who are viewed to be better looking receive higher instructional -->
<!-- ratings. -->

These data contain observations on 463 courses at the University of Texas 
Austin, with 23 variables recorded in the data:

- information about the course
- information about the professor
- information about number of students 
- information about the "attractiveness" rating of the professor

## Simple Linear Regression Review

We can model the relationship between a professor's evaluation score (`score`)
and their average attractiveness score (`bty_avg`) with a simple linear 
regression!

- Scores for average beauty can range from 0 to 10
- Evaluation scores can range from 1 to 5

</br>
</br>
<center>
__What are the model conditions we need to check for a simple linear regression?__ 


## Visualizing SLR

```{r slr-viz, echo = FALSE, eval = FALSE}
evals %>% 
  ggplot(aes(x = bty_avg, y = score)) + 
  geom_jitter() + 
  geom_smooth(method = "lm")

```

```{r, echo = FALSE}
decorate("slr-viz") %>% 
  flair("geom_jitter")
```

## Fitting a SLR Model

```{r}
model1 <- lm(score ~ bty_avg, data = evals)

get_regression_table(model1)
```

</br>
<center>

__How would we interpret the intercept and slope from this model?__

## Multiple Linear Regression

In multiple regression we include __multiple__ explanatory variables, which can 
be categorical or quantitative. 

</br>

- Categorical variables lead to different regression lines

- Quantitative variables lead to different planes in dataspace

</br>

__In this course, we will mainly stick to regression models with one
quantitative and one categorical explanatory variables.__ 

## Visualizing Multiple Linear Regression

```{r mlr-viz, eval = FALSE, echo = FALSE}
evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = rank)) + 
  geom_jitter() + 
  geom_smooth(method = "lm", se = FALSE)
```

```{r, echo = FALSE}
decorate("mlr-viz") %>% 
  flair("color = rank")
```


## Modeling Options

```{r, fig.width = 8, echo = FALSE}
p1 <- evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = rank)) + 
  geom_jitter() + 
  geom_smooth(method = "lm", se = FALSE) + 
  labs(title = "Different Slopes Model") + 
  theme(legend.position = "none")


p2 <- evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = rank)) + 
  geom_jitter() + 
  geom_parallel_slopes(se = FALSE) + 
  labs(title = "Parallel Slopes Model")

grid.arrange(p1, p2, nrow = 1, widths = c(0.45, 0.55))
```

## Fitting a Parallel Slopes Model

```{r}
model_parallel <- lm(score ~ bty_avg + rank, data = evals)

coef(model_parallel) %>% 
  tidy()
```

## Interpreting a Parallel Slopes Model

```{r, echo = FALSE}
coef(model_parallel) %>% 
  tidy()
```

</br> 

- Who does the `intercept` correspond to?

- What does the estimate labeled `ranktenure track` correspond to?

- What does the estimate labeled `ranktenured` correspond to?


## Calculating the Different Lines

| Gender    | Intercept | Slope for average beauty  |
| --------- |:---------:| -------------------------:|
| Teaching    | 3.98      | 0.068 |
| Tenure Track      | 3.98 - 0.161 = 3.819    | 0.068 |
| Tenured             | 3.98 - 0.126 = 3.854  | 0.068 | 

```{r, echo = FALSE, eval = FALSE}
options(digits = 4)

table <- get_regression_table(model_parallel)
intercept_teaching_parallel <- table %>% filter(term == "intercept") %>% pull(estimate)
offset_male <- table %>% filter(term == "gendermale") %>% pull(estimate)
slope <- table %>% filter(term == "bty_avg") %>% pull(estimate)
offset_male_parallel <- table %>% filter(term == "intercept") %>% pull(estimate)
intercept_male_parallel <- intercept_female_parallel + offset_male_parallel

tibble(
  Gender = c("Female instructors", "Male instructors"),
  Intercept = c(intercept_female_parallel, intercept_male_parallel),
  `Slope for age` = c(slope, slope)
) %>%
  kable(format = "html")
```

## Writing the Complete Parallel Slopes Model

$$
\widehat{score} = 3.98 - 0.161 \cdot 1_{\text{is tenure track}} - 0.126 \cdot 1_{\text{is tenured}} \\ + 0.068 \cdot \text{bty_avg}
$$
where 

$$
1_{\text{is tenure track}} = \begin{cases}
    1, &  \text{ if professor is tenure track} \\
    0, & \text{ if professor is not tenure track}
  \end{cases} 
$$
and 

$$
1_{\text{is tenured}} = \begin{cases}
    1, &  \text{ if professor is tenured} \\
    0, & \text{ if professor is not tenured}
  \end{cases} 
$$

## Writing Individual Regression Lines

- Teaching Professors:
$$
\widehat{score} = 3.98 + 0.068 \cdot bty\_avg
$$

- Tenure Track Professors:
$$
\widehat{score} = 3.819 + 0.068 \cdot bty\_avg
$$

- Tenured Professors:
$$
\widehat{score} = 3.854 + 0.068 \cdot bty\_avg
$$

## Fitting a Different Slopes Model

```{r mlr-slopes, eval = FALSE, echo = FALSE}
model_diff <- lm(score ~ bty_avg + rank + bty_avg:rank, data = evals)

coef(model_diff) %>% 
  tidy()
```

```{r, echo = FALSE}
decorate("mlr-slopes") %>% 
  flair("bty_avg:rank")
```

## Interpreting a Different Slopes Model

```{r}
coef(model_diff) %>% 
  tidy()
```


## Calculating the Different Lines

| Gender    | Intercept | Slope for average beauty  |
| --------- |:---------:| -------------------------:|
| Teaching   | 4.098      | 0.0417 |
| Tenure Track      | 4.098 - 0.019 = 4.079     | 0.0417 - 0.026 = 0.0157 |
| Tenured           | 4.098 - 0.409 = 3.689     | 0.0417 + 0.066 = 0.108 |

## Writing the Complete Different Slopes Model

$$
\widehat{score} = 3.95 - 0.019 \cdot 1_{\text{is tenure track}} - 0.409 \cdot 1_{\text{is tenured}} \\ + 0.068 \cdot \text{bty_avg} - 0.026 \cdot 1_{\text{is tenured}} \cdot \text{bty_avg} + \\ 0.066 \cdot 1_{\text{is tenured}} \cdot \text{bty_avg}    
$$
where 

$$
1_{\text{is tenure track}} = \begin{cases}
    1, &  \text{ if professor is tenure track} \\
    0, & \text{ if professor is not tenure track}
  \end{cases} 
$$
and 

$$
1_{\text{is tenured}} = \begin{cases}
    1, &  \text{ if professor is tenured} \\
    0, & \text{ if professor is not tenured}
  \end{cases} 
$$

## Writing Individal Regression Lines

- Teaching Professors:
$$
\widehat{score} = 4.098 + 0.047 \cdot bty\_avg
$$

- Tenure Track Professors:
$$
\widehat{score} = 4.079 + 0.0157 \cdot bty\_avg
$$

- Tenured Professors:
$$
\widehat{score} = 3.689 + 0.108 \cdot bty\_avg
$$

## Your Turn

```{r, fig.width = 5, fig.height = 3.25}
evals %>% 
  ggplot(aes(x = bty_avg, y = score, color = ethnicity)) + 
  geom_jitter() + 
  geom_smooth(method = "lm", se = FALSE)
```

__Does it seem reasonable to use a different slopes model?__ 

## 

```{r}
model_ethnicity <- lm(score ~ bty_avg + ethnicity + bty_avg:ethnicity, 
                      data = evals)

coef(model_ethnicity) %>% 
  tidy()
```

